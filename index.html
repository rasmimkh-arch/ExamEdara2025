<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª / Exam Management System</title>

    <!-- React + Tailwind via CDN for simplicity -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase compat SDK (for browsers) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(180deg,#f7fbff 0%,#eef2ff 100%); }
        [dir="rtl"] .text-left { text-align: left; }
        .no-select { user-select: none; -webkit-user-select: none; -ms-user-select: none; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

/* ============================
   Simple icons as emoji
   ============================ */
const Send = () => <span>ğŸ“¤</span>;
const Trash = () => <span>ğŸ—‘ï¸</span>;
const Bell = () => <span>ğŸ””</span>;
const Check = () => <span>âœ…</span>;
const Cancel = () => <span>âŒ</span>;
const Reply = () => <span>â†©ï¸</span>;

/* ============================
   Firebase initialization
   ============================ */
const firebaseConfig = {
  apiKey: "AIzaSyBF9s0UgAlbl2swjhjQX4wZ3SJXuQ1CccI",
  authDomain: "examedara.firebaseapp.com",
  projectId: "examedara",
  storageBucket: "examedara.firebasestorage.app",
  messagingSenderId: "1036021370726",
  appId: "1:1036021370726:web:d56497f745f295fbdb02a7"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.firestore();

/* ============================
   Main App
   ============================ */
function App(){
  const [mode, setMode] = useState('committee');
  const [selectedCommittee, setSelectedCommittee] = useState(1);
  const [reportText, setReportText] = useState('');
  const [studentsInput, setStudentsInput] = useState('');
  const [reports, setReports] = useState([]);
  const [committeesData, setCommitteesData] = useState({});
  const [settings, setSettings] = useState({ controlEnabled: false });
  const [playSound, setPlaySound] = useState(false);
  const audioCtxRef = useRef(null);

  // Load settings
  useEffect(() => {
    const docRef = db.collection('settings').doc('app');
    const unsub = docRef.onSnapshot(doc => {
      if (doc.exists){
        setSettings(doc.data());
      } else {
        docRef.set({ controlEnabled: false }).catch(()=>{});
        setSettings({ controlEnabled: false });
      }
    }, err => console.error(err));
    return () => unsub();
  }, []);

  // Listen to reports
  useEffect(() => {
    const q = db.collection('reports').orderBy('timestamp','desc');
    const unsub = q.onSnapshot(snapshot => {
      const arr = [];
      snapshot.forEach(doc => arr.push({ id: doc.id, ...doc.data() }));
      setReports(arr);
    }, err => console.error(err));
    return () => unsub();
  }, []);

  // Listen to committees docs (committee_1 .. committee_16)
  useEffect(() => {
    const coll = db.collection('committees');
    const unsub = coll.onSnapshot(snapshot => {
      const map = {};
      snapshot.forEach(doc => {
        map[doc.id] = doc.data();
      });
      setCommitteesData(map);
    }, err => console.error(err));
    return () => unsub();
  }, []);

  // Play sound when new unread reports and in control mode and control enabled
  useEffect(() => {
    const unread = reports.filter(r => !r.read && !r.cancelled).length;
    if (unread > 0 && mode === 'control' && settings.controlEnabled){
      setPlaySound(true);
    } else {
      setPlaySound(false);
    }
  }, [reports, mode, settings]);

  // WebAudio beep
  useEffect(() => {
    if (!playSound) return;
    try {
      if (!audioCtxRef.current) audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
      const ctx = audioCtxRef.current;
      const playBeep = () => {
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.setValueAtTime(900, ctx.currentTime);
        g.gain.setValueAtTime(0.001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.45);
        o.connect(g);
        g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + 0.5);
      };
      playBeep();
      const id = setInterval(playBeep, 3500);
      return () => clearInterval(id);
    } catch(e){
      console.warn('Audio error', e);
    }
  }, [playSound]);

  // Committee key
  const key = `committee_${selectedCommittee}`;
  const committeeDoc = committeesData[key] || { absent: [], present: [] };

  /* ----------------------
     Actions
     ---------------------- */

  // Send a report (from committee)
  const sendReport = async () => {
    if (!reportText.trim()){
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø¨Ù„Ø§Øº / Please enter report text');
      return;
    }
    try {
      await db.collection('reports').add({
        committee: selectedCommittee,
        text: reportText.trim(),
        read: false,
        cancelled: false,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        createdByClientTime: new Date().toISOString(),
        createdBy: `committee_${selectedCommittee}`
      });
      setReportText('');
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­ / Report sent successfully');
    } catch (err) {
      console.error(err);
      alert('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº / Failed to send report');
    }
  };

  // Cancel report (by sender)
  const cancelReport = async (id) => {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø§ØºØŸ / Cancel this report?')) return;
    try {
      await db.collection('reports').doc(id).update({
        cancelled: true,
        cancelledAt: new Date().toISOString()
      });
      alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ù„Ø§Øº / Report cancelled');
    } catch(err){
      console.error(err);
      alert('ÙØ´Ù„ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ù„Ø§Øº / Failed to cancel report');
    }
  };

  // Mark as read
  const markAsRead = async (id) => {
    try {
      await db.collection('reports').doc(id).update({ read: true, readAt: new Date().toISOString() });
    } catch(err){ console.error(err); }
  };

  // Reply to report (control sends "ØªÙ… Ø¹Ù…Ù„ Ø§Ù„Ù„Ø§Ø²Ù…" by default)
  const replyToReport = async (id, replyText='ØªÙ… Ø¹Ù…Ù„ Ø§Ù„Ù„Ø§Ø²Ù…') => {
    try {
      await db.collection('reports').doc(id).update({
        reply: replyText,
        replyAt: new Date().toISOString(),
        read: true
      });
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø³Ù„ / Reply sent to sender');
    } catch(err){ console.error(err); alert('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ / Failed to send reply'); }
  };

  // Delete single report (control)
  const deleteReport = async (id) => {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø§Øº Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ / Delete this report permanently?')) return;
    try {
      await db.collection('reports').doc(id).delete();
      alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ù„Ø§Øº / Report deleted');
    } catch(err){ console.error(err); alert('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù / Delete failed'); }
  };

  // Clear all reports (control)
  const clearAllReports = async () => {
    if (!confirm('Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ / This will delete ALL reports permanently. Are you sure?')) return;
    try {
      const snap = await db.collection('reports').get();
      const batch = db.batch();
      snap.forEach(d => batch.delete(d.ref));
      await batch.commit();
      alert('ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª / All reports deleted');
    } catch(err){ console.error(err); alert('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù / Delete failed'); }
  };

  // Add multiple absent students
  const addAbsentStudents = async () => {
    const raw = studentsInput.trim();
    if (!raw){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ / Please enter at least one student name'); return; }
    const names = raw.split(/\r?\n|,/).map(s => s.trim()).filter(Boolean);
    if (names.length === 0){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø© / No valid names found'); return; }
    try {
      const docRef = db.collection('committees').doc(key);
      const now = new Date().toISOString();
      for (const name of names){
        const stud = { id: `${Date.now()}_${Math.random().toString(36).slice(2,7)}`, name, time: now };
        await docRef.set({ absent: firebase.firestore.FieldValue.arrayUnion(stud) }, { merge: true });
        // Create a report for each student - notification after 10 minutes
        setTimeout(async () => {
          await db.collection('reports').add({
            committee: selectedCommittee,
            text: `Ø¥Ø´Ø¹Ø§Ø± ØºÙŠØ§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨: ${stud.name}`,
            read: false,
            cancelled: false,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            createdByClientTime: new Date().toISOString(),
            createdBy: `committee_${selectedCommittee}`
          });
        }, 10 * 60 * 1000);
      }
      setStudentsInput('');
      alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${names.length} Ø·Ø§Ù„Ø¨/Ø·Ø§Ù„Ø¨Ø© ÙƒÙ€ ØºØ§Ø¦Ø¨(ÙŠÙ†) / ${names.length} student(s) marked as absent`);
    } catch(err){ console.error(err); alert('ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ / Registration failed'); }
  };

  // Mark absent -> present (move from absent array to present array)
  const markPresent = async (committeeIndex, student) => {
    const docRef = db.collection('committees').doc(`committee_${committeeIndex}`);
    try {
      await docRef.update({ absent: firebase.firestore.FieldValue.arrayRemove(student) });
      const presentObj = { ...student, presentAt: new Date().toISOString() };
      await docRef.update({ present: firebase.firestore.FieldValue.arrayUnion(presentObj) });
      // create system report
      await db.collection('reports').add({
        committee: committeeIndex,
        text: `ØªØ­ÙˆÙŠÙ„ Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø­Ø¶ÙˆØ±: ${student.name}`,
        read: false,
        cancelled: false,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        createdByClientTime: new Date().toISOString(),
        createdBy: 'system'
      });
      alert('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø­Ø§Ø¶Ø± / Status changed to present');
    } catch(err){ console.error(err); alert('ÙØ´Ù„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© / Failed to change status'); }
  };

  // Clear attendance for all committees (absent & present)
  const clearAttendance = async () => {
    if (!confirm('Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ù…Ù† ÙƒÙ„ Ø§Ù„Ù„Ø¬Ø§Ù†. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ / This will clear all attendance records. Are you sure?')) return;
    try {
      for (let i=1;i<=16;i++){
        const docRef = db.collection('committees').doc(`committee_${i}`);
        await docRef.set({ absent: [], present: [] }, { merge: true });
      }
      alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ / All attendance records cleared');
    } catch(err){ console.error(err); alert('ÙØ´Ù„ Ø§Ù„Ù…Ø³Ø­ / Clear failed'); }
  };

  // Toggle control enabled, with password 50405040 for enabling
  const toggleControlEnabled = async () => {
    try {
      // If currently disabled and trying to enable -> ask for pass
      if (!settings.controlEnabled){
        const pass = prompt('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­ÙƒÙ…: / Enter password to enable control room:');
        if (pass !== '50405040'){
          alert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­ / Incorrect password');
          return;
        }
      }
      const newVal = !settings.controlEnabled;
      await db.collection('settings').doc('app').set({ controlEnabled: newVal }, { merge: true });
    } catch(err){ console.error(err); alert('ÙØ´Ù„ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­ÙƒÙ… / Failed to change control status'); }
  };

  // Try switching to control mode: ask for password if disabled
  const tryEnterControl = async () => {
    if (!settings.controlEnabled){
      const pass = prompt('ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¹Ø·Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªÙØ¹ÙŠÙ„Ù‡Ø§ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„:\nControl room is currently disabled. Enter password to enable and access:');
      if (!pass){
        alert('ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ / Cancelled');
        return;
      }
      if (pass !== '50405040'){
        alert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­ / Incorrect password');
        return;
      }
      try {
        await db.collection('settings').doc('app').set({ controlEnabled: true }, { merge: true });
        setMode('control');
        alert('ØªÙ… ØªÙØ¹ÙŠÙ„ ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­ / Control room enabled successfully');
      } catch(err){
        console.error(err);
        alert('ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… / Failed to enable control room');
      }
    } else {
      setMode('control');
    }
  };

  // Computed
  const unreadCount = reports.filter(r => !r.read && !r.cancelled).length;

  /* ============================
     Render
     ============================ */
  return (
    <div className="min-h-screen p-3 sm:p-6">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <header className="bg-white rounded-lg shadow p-4 mb-4">
          <h1 className="text-3xl font-bold text-center mb-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª / Exam Management System</h1>
          <div className="flex flex-col sm:flex-row justify-between items-center gap-3">
            <div className="text-center sm:text-right">
              <div className="text-2xl font-semibold">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù…Ù„ÙŠØ­Ø© Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø«Ø§Ù„Ø«Ø© Ù„Ù„Ø¨Ù†ÙŠÙ†</div>
              <div className="text-sm text-gray-600">School: Al-Maliha Boys â€“ Second & Third Cycle</div>
            </div>
            <div className="text-left">
              <div className="text-sm">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: <strong>{new Date().toISOString().slice(0,10)}</strong></div>
              <div className="text-xs text-gray-500">Server-synced via Firebase</div>
            </div>
          </div>

          <div className="mt-3 flex gap-2 justify-center">
            <button onClick={() => setMode('committee')} className={`px-4 py-2 rounded ${mode==='committee' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¬Ù†Ø© / Committee</button>
            <button onClick={tryEnterControl} className={`px-4 py-2 rounded ${mode==='control' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… / Control Room</button>
          </div>
        </header>

        {/* Body */}
        {mode === 'committee' ? (
          <div className="space-y-4">
            <div className="bg-white rounded-lg shadow p-4">
              <label className="block font-semibold mb-2">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø© / Select Committee:</label>
              <select value={selectedCommittee} onChange={e=>setSelectedCommittee(Number(e.target.value))} className="w-full p-2 border rounded">
                {[...Array(16)].map((_,i)=><option key={i+1} value={i+1}>Ù„Ø¬Ù†Ø© {i+1} / Committee {i+1}</option>)}
              </select>
            </div>

            <div className="bg-white rounded-lg shadow p-4">
              <h2 className="font-bold mb-2">Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù„Ø§Øº / Send Report</h2>
              <textarea value={reportText} onChange={e=>setReportText(e.target.value)} placeholder="Ù†Øµ Ø§Ù„Ø¨Ù„Ø§Øº Ù‡Ù†Ø§... / Write report here..." className="w-full p-2 border rounded h-28 mb-2"></textarea>
              <div className="flex gap-2">
                <button onClick={sendReport} className="flex-1 bg-blue-600 text-white rounded py-2 font-semibold">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº / Send Report <Send/></button>
              </div>

              <div className="mt-4">
                <h3 className="font-semibold mb-2">Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù„Ø¬Ù†Ø© (ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ù„ØºØ§Ø¡) / Your Committee Reports (Can Cancel)</h3>
                {reports.filter(r => r.createdBy === `committee_${selectedCommittee}`).length === 0 ? (
                  <p className="text-sm text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ù…Ø±Ø³Ù„Ø© Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¬Ù†Ø© / No reports sent from this committee</p>
                ) : (
                  <div className="space-y-2">
                    {reports.filter(r => r.createdBy === `committee_${selectedCommittee}`).map(r=>(
                      <div key={r.id} className={`p-2 rounded ${r.cancelled ? 'bg-gray-100' : 'bg-blue-50'} border`}>
                        <div className="flex justify-between items-center">
                          <div>
                            <div className="text-sm font-medium">{r.text}</div>
                            <div className="text-xs text-gray-600">{r.createdByClientTime ? r.createdByClientTime.slice(0,10) : ''}</div>
                            {r.reply && <div className="mt-1 text-sm text-green-700">Ø±Ø¯ / Reply: {r.reply}</div>}
                            {r.cancelled && <div className="mt-1 text-sm text-red-600">ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ù„Ø§Øº / Report Cancelled</div>}
                          </div>
                          <div className="flex gap-2">
                            {!r.cancelled && <button onClick={()=>cancelReport(r.id)} className="px-3 py-1 rounded bg-red-500 text-white text-sm flex items-center gap-1"><Cancel/> Ø¥Ù„ØºØ§Ø¡ / Cancel</button>}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>

            <div className="bg-white rounded-lg shadow p-4">
              <h2 className="font-bold mb-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø© ØºØ§Ø¦Ø¨ÙŠÙ† (Ø¹Ø¯Ø© Ø£Ø³Ù…Ø§Ø¡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©) / Register Absent Students (Multiple Names)</h2>
              <p className="text-sm text-gray-600 mb-2">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù…ÙØµÙˆÙ„Ø© Ø¨Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø¨ÙØ§ØµÙ„Ø©. Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØºÙŠØ§Ø¨ Ø¨Ø¹Ø¯ 10 Ø¯Ù‚Ø§Ø¦Ù‚. / Enter names separated by newline or comma. Absence notification will be sent after 10 minutes.</p>
              <textarea value={studentsInput} onChange={e=>setStudentsInput(e.target.value)} placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯
Ø¹Ù„ÙŠ Ø¹Ù…Ø±, Ø®Ø§Ù„Ø¯ Ø³Ø¹ÙŠØ¯" className="w-full p-2 border rounded h-28 mb-2"></textarea>
              <div className="flex gap-2">
                <button onClick={addAbsentStudents} className="flex-1 bg-red-600 text-white rounded py-2 font-semibold">ØªØ³Ø¬ÙŠÙ„ ØºØ§Ø¦Ø¨ / Mark Absent</button>
                <button onClick={()=>setStudentsInput('')} className="flex-1 bg-gray-200 rounded py-2">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„ / Clear Field</button>
              </div>

              <div className="mt-4">
                <h3 className="font-semibold mb-2">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ© / Current Absentees (Ù„Ø¬Ù†Ø© / Committee {selectedCommittee})</h3>
                {(committeeDoc.absent || []).length === 0 ? (
                  <p className="text-sm text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºÙŠØ§Ø¨ Ù…Ø³Ø¬Ù„ / No absences recorded</p>
                ) : (
                  <div className="space-y-2">
                    {(committeeDoc.absent || []).map(s=>(
                      <div key={s.id} className="flex justify-between items-center p-2 bg-red-50 rounded">
                        <div>
                          <div className="font-medium">{s.name}</div>
                          <div className="text-xs text-gray-600">{s.time ? s.time.slice(0,10) : ''}</div>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={()=>markPresent(selectedCommittee, s)} className="px-3 py-1 rounded bg-green-600 text-white text-sm flex items-center gap-1"><Check/> Ø­Ø¶Ø± / Present</button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>

            <footer className="text-center text-sm text-gray-600">ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¹Ù„Ù… Ø±Ø³Ù…ÙŠ Ø§Ù„Ø®ÙˆØ§Ù„Ø¯Ø© / Designed by Teacher Rasmi Khawaldeh</footer>
          </div>
        ) : (
          <div className="space-y-4">
            <div className="bg-white rounded-lg shadow p-4 flex justify-between items-center">
              <div>
                <h2 className="font-bold text-xl flex items-center gap-2"><Bell/> ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… / Control Room</h2>
                <p className="text-sm text-gray-600">ÙŠÙ…ÙƒÙ† Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù„Ø§Øº Ø£Ùˆ Ø­Ø°ÙÙ‡ Ø£Ùˆ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ Ø£Ùˆ Ù…Ø³Ø­ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„ØºÙŠØ§Ø¨. / You can reply to reports, delete them, clear all, or clear attendance records.</p>
              </div>
              <div className="flex items-center gap-2">
                <div className="text-sm">Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…ÙØ¹Ù‘Ù„Ø©ØŸ / Control Enabled?</div>
                <button onClick={toggleControlEnabled} className={`px-3 py-1 rounded ${settings.controlEnabled ? 'bg-green-600 text-white' : 'bg-gray-300'}`}>
                  {settings.controlEnabled ? 'Ù…ÙØ¹Ù„ / Enabled' : 'Ù…Ø¹Ø·Ù‘Ù„ / Disabled'}
                </button>

                <button onClick={clearAllReports} className="px-3 py-1 rounded bg-red-500 text-white flex items-center gap-1"><Trash/> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ / Clear All</button>
                <button onClick={clearAttendance} className="px-3 py-1 rounded bg-orange-500 text-white flex items-center gap-1">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ / Clear Attendance</button>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow p-4">
              <div className="flex justify-between items-center mb-3">
                <h3 className="font-bold">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© / Incoming Reports</h3>
                <div className="text-sm text-gray-600">{unreadCount} Ø¬Ø¯ÙŠØ¯ / new</div>
              </div>

              {reports.length === 0 ? (
                <p className="text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª / No reports available</p>
              ) : (
                <div className="space-y-2">
                  {reports.map(r=>(
                    <div key={r.id} className={`p-3 rounded border ${r.cancelled ? 'bg-gray-100 border-gray-300' : (!r.read ? 'bg-blue-50 border-blue-400' : 'bg-white border-gray-200')}`}>
                      <div className="flex justify-between items-start gap-2">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <span className="bg-blue-600 text-white px-2 rounded text-xs">Ù„Ø¬Ù†Ø© {r.committee} / Committee {r.committee}</span>
                            <span className="text-xs text-gray-600">{r.createdByClientTime ? r.createdByClientTime.slice(0,19).replace('T',' ') : ''}</span>
                            {r.cancelled && <span className="text-red-600 text-xs"> (Ù…Ù„ØºÙŠ / Cancelled)</span>}
                          </div>
                          <div className="text-sm mb-2 whitespace-pre-wrap">{r.text}</div>
                          {r.reply && <div className="text-sm text-green-700">Ø±Ø¯ Ø³Ø§Ø¨Ù‚ / Previous Reply: {r.reply} â€” {r.replyAt ? r.replyAt.slice(0,19).replace('T',' ') : ''}</div>}
                        </div>

                        <div className="flex flex-col gap-2">
                          {!r.cancelled && (
                            <>
                              <button onClick={()=>{ markAsRead(r.id); replyToReport(r.id, 'ØªÙ… Ø¹Ù…Ù„ Ø§Ù„Ù„Ø§Ø²Ù…'); }} className="px-3 py-1 rounded bg-green-600 text-white text-sm flex items-center gap-1"><Reply/> ØªÙ… Ø¹Ù…Ù„ Ø§Ù„Ù„Ø§Ø²Ù… / Done</button>
                              <button onClick={()=>markAsRead(r.id)} className="px-3 py-1 rounded bg-blue-500 text-white text-sm flex items-center gap-1"><Check/> Ù‚Ø±Ø§Ø¡Ø© / Read</button>
                            </>
                          )}
                          <button onClick={()=>deleteReport(r.id)} className="px-3 py-1 rounded bg-red-500 text-white text-sm flex items-center gap-1"><Trash/> Ø­Ø°Ù / Delete</button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            <div className="bg-white rounded-lg shadow p-4">
              <h3 className="font-bold mb-3">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø¬Ø§Ù†: Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨ / All Committees: Attendance Overview</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {[...Array(16)].map((_,i)=>{
                  const k = `committee_${i+1}`;
                  const c = committeesData[k] || { absent: [], present: [] };
                  return (
                    <div key={k} className="border rounded p-3">
                      <div className="font-semibold mb-2">Ù„Ø¬Ù†Ø© {i+1} / Committee {i+1}</div>
                      <div className="text-sm">
                        <div className="flex justify-between"><span>ØºØ§Ø¦Ø¨ / Absent:</span><span className="text-red-600 font-semibold">{(c.absent || []).length}</span></div>
                        <div className="flex justify-between"><span>Ø­Ø§Ø¶Ø± / Present:</span><span className="text-green-600 font-semibold">{(c.present || []).length}</span></div>
                      </div>
                      {(c.absent || []).length > 0 && (
                        <div className="mt-2 text-xs">
                          <div className="font-semibold">Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† / Absentees:</div>
                          <ul className="list-disc list-inside">
                            {c.absent.map(s=><li key={s.id}>{s.name}</li>)}
                          </ul>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>

            <footer className="text-center text-sm text-gray-600">ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¹Ù„Ù… Ø±Ø³Ù…ÙŠ Ø§Ù„Ø®ÙˆØ§Ù„Ø¯Ø© / Designed by Teacher Rasmi Khawaldeh</footer>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
